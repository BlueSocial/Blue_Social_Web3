"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.autoConnectInAppWallet = exports.connectInAppWallet = exports.isInAppWallet = void 0;
const ethereum_js_1 = require("../../../../chains/chain-definitions/ethereum.js");
const type_js_1 = require("../authentication/type.js");
/**
 * Checks if the provided wallet is an in-app wallet.
 *
 * @param wallet - The wallet to check.
 * @returns True if the wallet is an in-app wallet, false otherwise.
 */
function isInAppWallet(wallet) {
    return wallet.id === "inApp" || wallet.id === "embedded";
}
exports.isInAppWallet = isInAppWallet;
/**
 * @internal
 */
async function connectInAppWallet(options, createOptions, connector) {
    const authResult = await connector.authenticate(options);
    const authAccount = authResult.user.account;
    if (createOptions?.smartAccount) {
        return convertToSmartAccount({
            client: options.client,
            authAccount,
            smartAccountOptions: createOptions.smartAccount,
            chain: options.chain,
        });
    }
    return [
        authAccount,
        options.chain || createOptions?.smartAccount?.chain || ethereum_js_1.ethereum,
    ];
}
exports.connectInAppWallet = connectInAppWallet;
/**
 * @internal
 */
async function autoConnectInAppWallet(options, createOptions, connector) {
    const user = await getAuthenticatedUser(connector);
    if (!user) {
        throw new Error("not authenticated");
    }
    const authAccount = user.account;
    if (createOptions?.smartAccount) {
        return convertToSmartAccount({
            client: options.client,
            authAccount,
            smartAccountOptions: createOptions.smartAccount,
            chain: options.chain,
        });
    }
    return [
        authAccount,
        options.chain || createOptions?.smartAccount?.chain || ethereum_js_1.ethereum,
    ];
}
exports.autoConnectInAppWallet = autoConnectInAppWallet;
async function convertToSmartAccount(options) {
    const [{ smartWallet }, { connectSmartWallet }] = await Promise.all([
        Promise.resolve().then(() => require("../../../smart/smart-wallet.js")),
        Promise.resolve().then(() => require("../../../smart/index.js")),
    ]);
    const sa = smartWallet(options.smartAccountOptions);
    return connectSmartWallet(sa, {
        client: options.client,
        personalAccount: options.authAccount,
        chain: options.chain,
    }, options.smartAccountOptions);
}
async function getAuthenticatedUser(connector) {
    const user = await connector.getUser();
    switch (user.status) {
        case type_js_1.UserWalletStatus.LOGGED_IN_WALLET_INITIALIZED: {
            return user;
        }
    }
    return undefined;
}
//# sourceMappingURL=index.js.map